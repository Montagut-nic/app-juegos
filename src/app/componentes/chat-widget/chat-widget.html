<button class="chat-toggle" *ngIf="isLoggedIn" (click)="toggle()">Chat</button>
<section class="chat-window" *ngIf="isLoggedIn && open()">
    <header class="chat-header">
        <strong>Chat Global</strong>
        <button class="min" (click)="toggle()">—</button>
    </header>

    <div class="chat-body" #scrollBox>
        @for(m of messages(); track m.id) {
        <div class="line" [class.propio]="esPropio(m)" [class.ajeno]="!esPropio(m)">
            <div class="burbuja">
                <div class="meta">
                    <div> </div>
                    {{ m.created_at | date:'d-M-y HH:mm' }} - <div style="font-size: 14px;">{{ m.usuario }}</div>
                </div>
                <div class="text">{{ m.contenido }}</div>
            </div>
        </div>
        } @empty {
        <div class="line empty">No hay mensajes.</div>
        }
    </div>

    <footer class="chat-input">
        <textarea [disabled]="sending()" placeholder="Escribe un mensaje…" [value]="text()"
            (input)="text.set(($any($event.target)).value)" (keydown)="onKeydown($event)" maxlength="500"
            rows="2"></textarea>
        <button class="send" (click)="send()" [disabled]="sending() || !text().trim()">Enviar</button>
    </footer>
</section>